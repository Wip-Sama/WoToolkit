package org.wip.womtoolkit.view.pages

import javafx.fxml.FXML
import javafx.fxml.FXMLLoader
import javafx.scene.control.Label
import javafx.scene.control.ScrollPane
import javafx.scene.layout.BorderPane
import org.wip.womtoolkit.view.components.PageIndicator
import org.wip.womtoolkit.view.components.collapsablesidebarmenu.CollapsableComponent
import org.wip.womtoolkit.view.components.collapsablesidebarmenu.CollapsableSidebarMenu
import org.wip.womtoolkit.model.services.localization.LocalizationService
import org.wip.womtoolkit.view.pages.settings.AboutSettings
import org.wip.womtoolkit.view.pages.settings.ConverterSettings
import org.wip.womtoolkit.view.pages.settings.GeneralSettings
import org.wip.womtoolkit.view.pages.settings.HistorySettings
import org.wip.womtoolkit.view.pages.settings.ModuleSettings
import org.wip.womtoolkit.view.pages.settings.SlicerSettings

class Settings(val pageIndicator: PageIndicator? = null) : BorderPane() {
	@FXML lateinit var sectionSelector: CollapsableSidebarMenu
	@FXML lateinit var elementContainer: ScrollPane
	val l: Label = Label()

	object Contents {
		const val GENERAL: String =
			"M17.9344 3.00514L17.75 3H6.25L6.06558 3.00514C4.35645 3.10075 3 4.51697 3 6.25V17.75L3.00514 17.9344C3.10075 19.6435 4.51697 21 6.25 21H12.0224C11.6347 20.3945 11.3447 19.7204 11.1745 19H6.25L6.12219 18.9935C5.49187 18.9295 5 18.3972 5 17.75L5.0012 8H19L19.0004 11.1739C19.7211 11.3441 20.3954 11.6343 21.0012 12.0222V6.25L20.9961 6.06558C20.9039 4.4175 19.5837 3.09734 17.9344 3.00514ZM10.9932 10.1482C10.9435 9.78215 10.6297 9.5 10.25 9.5H6.75L6.64823 9.50685C6.28215 9.55651 6 9.8703 6 10.25V17.25L6.00685 17.3518C6.05651 17.7178 6.3703 18 6.75 18H10.25L10.3518 17.9932C10.7178 17.9435 11 17.6297 11 17.25V10.25L10.9932 10.1482ZM7.5 11H9.5V16.5H7.5V11ZM18 10.25C18 9.83579 17.6642 9.5 17.25 9.5H12.7544L12.6526 9.50685C12.2866 9.55651 12.0044 9.8703 12.0044 10.25C12.0044 10.6642 12.3402 11 12.7544 11H17.25L17.3518 10.9932C17.7178 10.9435 18 10.6297 18 10.25ZM14.2787 13.9754C14.5935 15.0656 13.9391 16.1991 12.8375 16.4716L12.2533 16.6161C12.2084 16.9038 12.1851 17.199 12.1851 17.4998C12.1851 17.8145 12.2106 18.123 12.2597 18.4232L12.7991 18.5532C13.9116 18.8211 14.573 19.9661 14.2491 21.0636L14.0628 21.6949C14.5019 22.0805 15.0024 22.3937 15.5469 22.6165L16.0402 22.0977C16.8288 21.2685 18.1511 21.2687 18.9393 22.0982L19.438 22.623C19.9816 22.4027 20.4816 22.0925 20.9208 21.7101L20.7228 21.0242C20.4081 19.9339 21.0624 18.8005 22.164 18.528L22.7477 18.3835C22.7926 18.0958 22.816 17.8006 22.816 17.4998C22.816 17.1851 22.7904 16.8765 22.7414 16.5762L22.2024 16.4464C21.0899 16.1785 20.4286 15.0335 20.7524 13.9359L20.9386 13.3051C20.4995 12.9193 19.999 12.6061 19.4544 12.3833L18.9613 12.9018C18.1727 13.7311 16.8505 13.7309 16.0622 12.9013L15.5634 12.3765C15.0198 12.5967 14.5199 12.9068 14.0806 13.2892L14.2787 13.9754ZM17.5005 18.9998C16.6999 18.9998 16.0509 18.3282 16.0509 17.4998C16.0509 16.6714 16.6999 15.9998 17.5005 15.9998C18.3012 15.9998 18.9502 16.6714 18.9502 17.4998C18.9502 18.3282 18.3012 18.9998 17.5005 18.9998Z"
		const val ABOUT: String =
			"M12.0016 1.99902C17.5253 1.99902 22.0031 6.47687 22.0031 12.0006C22.0031 17.5243 17.5253 22.0021 12.0016 22.0021C6.47785 22.0021 2 17.5243 2 12.0006C2 6.47687 6.47785 1.99902 12.0016 1.99902ZM12 10.5C11.5858 10.5 11.25 10.8358 11.25 11.25V16.25C11.25 16.6642 11.5858 17 12 17C12.4142 17 12.75 16.6642 12.75 16.25V11.25C12.75 10.8358 12.4142 10.5 12 10.5ZM12 9C12.5523 9 13 8.55228 13 8C13 7.44772 12.5523 7 12 7C11.4477 7 11 7.44772 11 8C11 8.55228 11.4477 9 12 9Z"
		const val SLICER: String =
			"M7.8294 2.43943C7.52083 1.98139 6.89937 1.86022 6.44132 2.16879C5.98328 2.47736 5.86211 3.09882 6.17068 3.55686L10.9634 10.6711L8.63676 14.3487C8.13715 14.1244 7.58315 13.9996 7 13.9996C4.79086 13.9996 3 15.7905 3 17.9996C3 20.2087 4.79086 21.9996 7 21.9996C9.20914 21.9996 11 20.2087 11 17.9996C11 17.1029 10.705 16.2752 10.2067 15.6081L12.1839 12.4828L14.0676 15.2791C13.4051 15.9929 13 16.9489 13 17.9996C13 20.2087 14.7909 21.9996 17 21.9996C19.2091 21.9996 21 20.2087 21 17.9996C21 15.7905 19.2091 13.9996 17 13.9996C16.5639 13.9996 16.1441 14.0694 15.7511 14.1984L12.1319 8.82411L12.1313 8.8251L7.8294 2.43943ZM5 17.9996C5 16.895 5.89543 15.9996 7 15.9996C8.10457 15.9996 9 16.895 9 17.9996C9 19.1042 8.10457 19.9996 7 19.9996C5.89543 19.9996 5 19.1042 5 17.9996ZM15 17.9996C15 16.895 15.8954 15.9996 17 15.9996C18.1046 15.9996 19 16.895 19 17.9996C19 19.1042 18.1046 19.9996 17 19.9996C15.8954 19.9996 15 19.1042 15 17.9996ZM14.5202 8.78988L17.8452 3.53421C18.1404 3.06749 18.0014 2.44977 17.5347 2.1545C17.068 1.85922 16.4503 1.99821 16.155 2.46494L13.2998 6.97801L14.5202 8.78988Z"
		const val CONVERTER: String =
			"M14.7123 2.28878L14.6251 2.21113C14.2326 1.90052 13.6607 1.92641 13.2981 2.28878L13.2204 2.37594C12.9096 2.76818 12.9355 3.33963 13.2981 3.702L14.597 4.99899L8.99921 4.99919L8.75859 5.00325C5.00445 5.12998 2 8.21112 2 11.9935C2 13.4382 2.43833 14.7806 3.18863 15.8918C3.37024 16.1432 3.666 16.3068 4 16.3068C4.55228 16.3068 5 15.8594 5 15.3075C5 15.0914 4.93132 14.8912 4.81525 14.7288L4.68008 14.5107C4.24775 13.7716 4 12.9114 4 11.9935C4 9.23444 6.23822 6.99779 8.99921 6.99779L14.595 6.99758L13.2981 8.29497L13.2204 8.38213C12.9096 8.77438 12.9355 9.34582 13.2981 9.7082C13.6886 10.0984 14.3218 10.0984 14.7123 9.7082L17.7175 6.7051L17.7952 6.61794C18.106 6.2257 18.0801 5.65425 17.7175 5.29188L14.7123 2.28878ZM20.7865 8.06013C20.6034 7.82751 20.3191 7.67811 20 7.67811C19.4477 7.67811 19 8.12551 19 8.67741C19 8.88559 19.0637 9.0789 19.1717 9.23841C19.6952 10.0282 20 10.9753 20 11.9935C20 14.7525 17.7618 16.9892 15.0008 16.9892L9.415 16.9886L10.7087 15.6972L10.7923 15.6025C11.0733 15.2408 11.0713 14.7307 10.7864 14.3712L10.7087 14.284L10.6139 14.2004C10.252 13.9196 9.7415 13.9216 9.38169 14.2063L9.29447 14.284L6.28926 17.2871L6.20562 17.3818C5.92465 17.7435 5.92663 18.2536 6.21156 18.6132L6.28926 18.7003L9.29447 21.7034L9.38867 21.7865C9.78097 22.0913 10.3482 22.0636 10.7087 21.7034C11.0713 21.341 11.0972 20.7696 10.7864 20.3773L10.7087 20.2902L9.405 18.9872L15.0008 18.9878L15.2414 18.9837C18.9956 18.857 22 15.7759 22 11.9935C22 10.5336 21.5524 9.17809 20.7868 8.05666L20.7865 8.06013Z"
		const val HISTORY: String = //history
			"M12 5C15.866 5 19 8.13401 19 12C19 15.866 15.866 19 12 19C8.13401 19 5 15.866 5 12C5 11.7028 5.01846 11.4104 5.05421 11.1237C5.12255 10.5757 4.73367 10.076 4.18563 10.0077C3.63759 9.93935 3.13792 10.3282 3.06958 10.8763C3.02362 11.2448 3 11.6199 3 12C3 16.9706 7.02944 21 12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C10.15 3 8.42985 3.5588 7 4.51575V4C7 3.44772 6.55228 3 6 3C5.44772 3 5 3.44772 5 4V7C5 7.55228 5.44772 8 6 8H9C9.55228 8 10 7.55228 10 7C10 6.44772 9.55228 6 9 6H8.39202C9.4458 5.36484 10.68 5 12 5ZM13 8C13 7.44772 12.5523 7 12 7C11.4477 7 11 7.44772 11 8V12C11 12.5523 11.4477 13 12 13H14.5C15.0523 13 15.5 12.5523 15.5 12C15.5 11.4477 15.0523 11 14.5 11H13V8Z"
		const val MODULES: String = //modules
			"M18.4923 2.33034L21.671 5.50911C22.5497 6.38779 22.5497 7.81241 21.671 8.69109L19.0866 11.275C20.1696 11.4375 21 12.3718 21 13.5V18.75C21 19.9926 19.9926 21 18.75 21H5.25C4.00736 21 3 19.9926 3 18.75V5.25001C3 4.00736 4.00736 3.00001 5.25 3.00001H10.5C11.6289 3.00001 12.5637 3.83146 12.7253 4.91541L15.3103 2.33034C16.189 1.45166 17.6136 1.45166 18.4923 2.33034ZM4.5 18.75C4.5 19.1642 4.83579 19.5 5.25 19.5L11.249 19.4993L11.25 12.75L4.5 12.7493V18.75ZM12.749 19.4993L18.75 19.5C19.1642 19.5 19.5 19.1642 19.5 18.75V13.5C19.5 13.0858 19.1642 12.75 18.75 12.75L12.749 12.7493V19.4993ZM10.5 4.50001H5.25C4.83579 4.50001 4.5 4.83579 4.5 5.25001V11.2493H11.25V5.25001C11.25 4.83579 10.9142 4.50001 10.5 4.50001ZM12.75 9.30933V11.25L14.69 11.2493L12.75 9.30933Z"
	}

	init {
		FXMLLoader(javaClass.getResource("/view/pages/settings.fxml")).apply {
			setRoot(this@Settings)
			setController(this@Settings)
			load()
		}

		sceneProperty().addListener { _, oldScene, newScene ->
			if (oldScene != null && newScene == null) {
				pageIndicator?.removeLabel()
			}
		}
	}

	@FXML
	fun initialize() {
		val general = CollapsableComponent().apply {
			icon.content = Contents.GENERAL
			localizationKey = "settingsPage.general"
		}
		sectionSelector.addComponent(general)
		sectionSelector.addComponent(
			CollapsableComponent().apply {
				icon.content = Contents.SLICER
				localizationKey = "settingsPage.slicer"
			}
		)
		sectionSelector.addComponent(
			CollapsableComponent().apply {
				icon.content = Contents.CONVERTER
				localizationKey = "settingsPage.converter"
			}
		)

		sectionSelector.addComponent(
			CollapsableComponent().apply {
				icon.content = Contents.HISTORY
				localizationKey = "settingsPage.history"
			},
			position = CollapsableSidebarMenu.Positions.BOTTOM
		)
		sectionSelector.addComponent(
			CollapsableComponent().apply {
				icon.content = Contents.MODULES
				localizationKey = "settingsPage.modules"
			},
			position = CollapsableSidebarMenu.Positions.BOTTOM
		)
		sectionSelector.addComponent(
			CollapsableComponent().apply {
				icon.content = Contents.ABOUT
				localizationKey = "settingsPage.about"
			},
			position = CollapsableSidebarMenu.Positions.BOTTOM
		)

		var happened = false
		sectionSelector.selectedItemProperty.addListener { _, _, newValue ->
			if (!happened) {
				pageIndicator?.addLabel(l)
				happened = true
			}
		}

		sectionSelector.selectedItemProperty.addListener { _, _, newValue ->
			if (newValue != null) {
				l.textProperty().bind(LocalizationService.lsb("${newValue.localizationKey}"))
			}
		}

		sectionSelector.selectedItemProperty.addListener { _, _, newValue ->
			when (newValue?.localizationKey) {
				"settingsPage.general" -> elementContainer.content = GeneralSettings()
				"settingsPage.slicer" -> elementContainer.content = SlicerSettings()
				"settingsPage.converter" -> elementContainer.content = ConverterSettings()
				"settingsPage.history" -> elementContainer.content = HistorySettings()
				"settingsPage.modules" -> elementContainer.content = ModuleSettings()
				"settingsPage.about" -> elementContainer.content = AboutSettings()
				else -> elementContainer.content = null
			}
		}

		sectionSelector.selectedItemProperty.value = general
		elementContainer.content = GeneralSettings()
	}
}